---
output: html_document
editor_options: 
  chunk_output_type: console
---
[comment]: <> (Machine Learning with R Cookbook, capitulo 4)
[comment]: <> (Torgo, 4.6)
# Regresión

$$y=f(x_1,x_2, \ldots)$$

  * $y$ Variable de resultado, dependiente, solo tenemos a una $y$. 
  * $x_1, x_2, \ldots$, variables de control, independientes.
  
 A partir de estas variables:
 
  * ¿Cuál es la relación de $x$ sobre $y$?
    + Lineal  

$$y_i=\beta_0+\beta_1 x_1+\beta_2x_2+\ldots+\epsilon_i$$
> Nota: Diferenciar que la regresión busca establacer relaciones basadas en los datos y no asi un proceso causal.

    + Polinomial
    + Etc; No lineal,
    
  * Conocer la naturaleza de $y$ y las variables $x$
    + $Y$ es cuanti (real), $X$ cuanti. 
    + $Y$ es cuanti (discreta >= 0), $X$ cuanti. 
    + $Y$ es cuali nominal binario, $X$ mixtas. 
    + $Y$ es cuali ordinal, $X$ mixtas. 

## Regresión lineal

### Paso 1: Base de datos

```{r}
library(dplyr)
load(url("https://github.com/AlvaroLimber/EST-384/raw/master/data/eh18.Rdata"))
bd<-eh18p %>% filter(s02a_03>=18 & s02a_05=="1.JEFE O JEFA DEL HOGAR" & ocupado=="Si") %>% select(s02a_02,s02a_03,aestudio,tothrs,ylab,ynolab,factor,estrato, upm,area,permanente,cob_op)
```

### Paso 2: Establecer la relación de interés.

  * $Y$ Ingreso laboral puede ser un buena opción
  * $X$ el resto, pueden ser basadas en un modelo teórico o buscadas a partir de un proceso de minería de datos

$$IngresoLaboral=f(edad,sexo,educación,...)$$

### Paso 3: Definir el modelo a utilizar

OLS, MCO. Modelos lineales

```{r}
m1<-lm(ylab~s02a_03,data=bd)# regresión lineal simple y=f(x)
m1
```

$$ylab_i=\beta_0+\beta_1edad_i+\epsilon_i$$

$$E[ylab_i]=4112.16-21.84*edad_i$$

```{r}
plot(bd$s02a_03,bd$ylab)
abline(m1,col="red",lwd=2)
summary(m1)
#en los betas
coefficients(m1)
confint(m1,level=0.99)
#mejorar el modelo
m2<-lm(ylab~s02a_03+aestudio+tothrs+ynolab+s02a_02+area+cob_op,data=bd)
summary(m2)
m3<-lm(log(ylab)~s02a_03+aestudio+tothrs+ynolab+s02a_02+area+cob_op,data=bd)
summary(m3)
m4<-lm(log(ylab)~s02a_03+factor(aestudio)+tothrs+ynolab+s02a_02+area+cob_op,data=bd)
summary(m4)
```

### Paso 4: Optimizar el modelo

```{r}
m5<-lm(log(ylab)~.,data=bd[,-c(7,8,9,11)])
summary(m5)
m6<-step(m5)
summary(m6)
length(coefficients(m6))
length(coefficients(m5))
#un ejemplo de laboratorio
bd2<-as.data.frame(matrix(rnorm(1000),ncol = 8))
names(bd2)[1]<-"y"
bd2$x<-bd2$y+runif(125)
plot(bd2$x,bd2$y)
plot(bd2)
p1<-lm(y~.,data=bd2)
summary(p1)
p2<-step(p1)
summary(p2)
```


### Paso 5: Validar el modelo

### Paso 6: Predicir a partir del modelo



## Probit y Logit
